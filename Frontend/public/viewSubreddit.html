<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="./css/viewsubreddit.css" />
    <title>Reddit clone</title>
  </head>

  <script>
    $(document).ready(function () {
      var urlParams = new URLSearchParams(window.location.search);
      var subredditid = urlParams.get("subreddit_id");
      var postshtml = "";
      var headerhtml = "";
      var createhtml = "";
      $.ajax({
        url: `http://localhost:8000/api/subreddits/searchSubredditID/${subredditid}`,
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        success: function (data, textStatus, xhr) {
          if (data != null) {
            headerhtml += ` 
                        <h3>${data.name}</h3>
                        <p>${data.description}</p>
                        
                        `;
          } else {
            headerhtml += ` 
                        <h3>${data.name}</h3>
                        <p>${data.description}</p>
                        
                        `;

            console.log("Issue in retrieving...");
          }
          $("#subredditName").append(headerhtml);
        },
        error: function (xhr, textStatus, err) {
          console.log(err);
        },
      });

      $.ajax({
        url: `http://localhost:8000/api/subreddits/searchSubredditID/${subredditid}`,
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        success: function (data, textStatus, xhr) {
          if (data != null) {
            createhtml += ` 
                    <a href="post.html?subreddit_id=${subredditid}" class="btn btn-primary" style="background-color: white; color: black; border-color: black;max-width: 100px; margin: auto; display: block;">Create Post</a>
                        
                        `;
          } else {
            createhtml += ` 
                    <a href="post.html?subreddit_id=${subredditid}" class="btn btn-primary" style="background-color: white; color: black; border-color: black;max-width: 100px; margin: auto; display: block;">Create Post</a>
                        
                        `;

            console.log("Issue in retrieving...");
          }
          $("#createpost").append(createhtml);
        },
        error: function (xhr, textStatus, err) {
          console.log(err);
        },
      });

      $.ajax({
        url: `http://localhost:8000/api/post/subredditPost/${subredditid}`,
        type: "GET",
        contentType: "application/json",
        dataType: "json",
        success: function (data, textStatus, xhr) {
          if (data != null) {
            data.post.map((d) => {
              postshtml += `
                            
                  `;
              if (d.cloudinary_url != null) {
                postshtml += `
                      <div class = "card">

                    <div>
                       Title: ${d.title}
                    </div>
                    <div>
                        <img src= "${d.cloudinary_url}"/>
                    <div>
                        <div>
                       Content: ${d.body}
                    </div>
                    <div>
                       Created at: ${d.created_at}
                    </div>
                    
                    
                  </div>
                      `;
              } else {
                postshtml += `
                      <div class = "card">
                      <div>
                       Title: ${d.title}
                    </div>
                    <div>
                       Content: ${d.body}
                    </div>
                    
                    <div>
                       Created At: ${d.created_at}
                    </div>
                  </div>`;
              }
            });

            $("#posts").append(postshtml);
          } else {
            console.log("Issue in retrieving...");
          }
        },
        error: function (xhr, textStatus, err) {
          console.log(err);
        },
      });
    });
  </script>
  <header id="subredditName"></header>

  <body>
    <p id="createpost"></p>
    <div id="posts"></div>
  </body>
</html>
